{"version":3,"sources":["webpack:///./src/views/supplier-backend/components/HTable/uses/useExport.ts","webpack:///./node_modules/core-js/internals/create-html.js","webpack:///./node_modules/core-js/internals/string-html-forced.js","webpack:///./node_modules/core-js/modules/es.string.fixed.js"],"names":["useExport","pageType","exportOptions","formParams","params","columns","rows","footer","state","exportStr","exportUrl","baseUrl","url","backExportUrl","stringify","action","getExportData","keys","fixKeys","getHeader","titles","fixTitles","helper","arr","prevItems","item","children","length","title","map","_item","join","targetTitles","fixed","targetKeys","push","key","titlesStr","getRows","rowsArr","rowArr","val","objVal","resVal","replace","rowsStr","getFooter","footerArr","Object","values","footerStr","requireObjectCoercible","quot","module","exports","string","tag","attribute","value","S","String","p1","fails","METHOD_NAME","test","toLowerCase","split","$","createHTML","forcedStringHTMLMethod","target","proto","forced","this"],"mappings":"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","file":"js/chunk-fa42292c.aef14600.js","sourcesContent":["/* eslint-disable no-restricted-syntax */\nimport {\n  computed, getCurrentInstance, reactive, toRefs,\n} from '@vue/composition-api';\nimport qs from 'query-string';\n\ntype Obj = {[key in string|number]:any};\n\ntype ExportOptions = {\n  url: string,\n  text:string,\n  name:string,\n  size: string,\n  data: string,\n  getExportData: ()=>string\n} | false;\n\ninterface ExportData{\n  formParams: Obj,\n  params:Obj,\n  columns:Obj[],\n  rows:Obj[],\n  footer:Obj\n}\n\nconst useExport = (pageType:'back'|'front' = 'back', exportOptions:ExportOptions = false, {\n  formParams = {}, params = {}, columns = [], rows = [], footer = {},\n}:ExportData) => {\n  const state = reactive({\n    exportStr: '',\n    exportUrl: computed(() => {\n      if (pageType === 'front') return '';\n      const baseUrl = (exportOptions && exportOptions.url) || '';\n      const backExportUrl = `${baseUrl}?${qs.stringify({ ...formParams, ...params, action: 'export' })}`;\n      return backExportUrl;\n    }),\n  });\n  const getExportData = () => {\n    // 普通表头数组\n    const keys:string[] = [];\n    // 固定表头数组\n    const fixKeys:string[] = [];\n    const getHeader = () => {\n      const titles:string[] = [];\n      const fixTitles:string[] = [];\n\n      const helper = (arr:Obj[], prevItems:Obj[] = []) => {\n        // eslint-disable-next-line no-restricted-syntax\n        for (const item of arr) {\n          if (item.children && item.children.length) {\n            helper(item.children, [...prevItems, item]);\n          } else {\n            const title = [...prevItems, item].map(_item => _item.title).join('-');\n            const targetTitles = item.fixed ? fixTitles : titles;\n            const targetKeys = item.fixed ? fixKeys : keys;\n            targetTitles.push(title);\n            targetKeys.push(item.key);\n          }\n        }\n      };\n\n      helper(columns);\n\n      const titlesStr = `${[...fixTitles, ...titles].join()}\\n`;\n      return titlesStr;\n    };\n    const getRows = () => {\n      const rowsArr:string[] = [];\n      for (const item of rows) {\n        const rowArr = [];\n        for (const key of [...fixKeys, ...keys]) {\n          const val = item[key] ?? '';\n          const objVal = (val && val.title) ?? '';\n          let resVal = objVal ?? val;\n          if (+resVal && resVal.length > 11) resVal = `\\t${resVal}`; // 超过11位的数字不显示计数法\n          resVal = `${resVal}`.replace(/,/g, '-'); // ','是csv格式，需修改为'-'\n\n          rowArr.push(resVal);\n        }\n        rowsArr.push(`${rowArr.join()}\\n`);\n      }\n      const rowsStr = rowsArr.join('');\n      return rowsStr;\n    };\n    const getFooter = () => {\n      const footerArr = Object.values(footer);\n      const footerStr = footerArr ? `${footerArr.join()}\\n` : '';\n      return footerStr;\n    };\n\n    return getHeader() + getRows() + getFooter();\n  };\n  return {\n    ...toRefs(state),\n    getExportData,\n  };\n};\n\nexport default useExport;\n","var requireObjectCoercible = require('../internals/require-object-coercible');\n\nvar quot = /\"/g;\n\n// B.2.3.2.1 CreateHTML(string, tag, attribute, value)\n// https://tc39.github.io/ecma262/#sec-createhtml\nmodule.exports = function (string, tag, attribute, value) {\n  var S = String(requireObjectCoercible(string));\n  var p1 = '<' + tag;\n  if (attribute !== '') p1 += ' ' + attribute + '=\"' + String(value).replace(quot, '&quot;') + '\"';\n  return p1 + '>' + S + '</' + tag + '>';\n};\n","var fails = require('../internals/fails');\n\n// check the existence of a method, lowercase\n// of a tag and escaping quotes in arguments\nmodule.exports = function (METHOD_NAME) {\n  return fails(function () {\n    var test = ''[METHOD_NAME]('\"');\n    return test !== test.toLowerCase() || test.split('\"').length > 3;\n  });\n};\n","'use strict';\nvar $ = require('../internals/export');\nvar createHTML = require('../internals/create-html');\nvar forcedStringHTMLMethod = require('../internals/string-html-forced');\n\n// `String.prototype.fixed` method\n// https://tc39.github.io/ecma262/#sec-string.prototype.fixed\n$({ target: 'String', proto: true, forced: forcedStringHTMLMethod('fixed') }, {\n  fixed: function fixed() {\n    return createHTML(this, 'tt', '', '');\n  }\n});\n"],"sourceRoot":""}